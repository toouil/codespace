import{r as x,j as e,a as h}from"./app-xtGLZL-7.js";import{W as P,d as T,e as $,f as L,A as F,X as S,S as R,P as E}from"./index-BIcDevOB.js";import{i as y,s as I}from"./Functions-DjAUCTNG.js";import{u as f}from"./useApi-DH0F1Rzl.js";import{L as W}from"./Loader-Br331SDq.js";import{S as q}from"./Search-BicGA6Uk.js";import{a as A}from"./Notify-Dlq59V6X.js";import{N as D}from"./NotFound-BrCcBTbO.js";function B({post:t,setCommentsTab:s}){const{username:c,picture:o,postid:r,age:_,formatted_created_at:l,tags:d,content:u,likes:p,comments:n,isLiked:i,visibility:a}=t,{postRequest:N}=f({dataTemplate:{postid:r},onSuccess:m=>{var j,k;(m==null?void 0:m.status)==200&&(C({liked:(j=m==null?void 0:m.data)==null?void 0:j.liked,count:(k=m==null?void 0:m.data)==null?void 0:k.count}),g({...v,like:null}))}}),[b,C]=x.useState({liked:i,count:p}),[v,g]=x.useState({like:null,comment:null}),w=()=>{g({...v,like:!0}),N(route("post.like"))};return e.jsxs("div",{className:"post container",children:[e.jsx("div",{className:"post_header",children:e.jsxs("div",{className:"post_header_user",children:[e.jsx("div",{className:"user_picture",children:e.jsx(h,{href:`/profile/${c}`,className:"post_user_picture_link",children:e.jsx("img",{src:o,alt:"user_img"})})}),e.jsxs("div",{className:"user_post_details",children:[e.jsx("span",{className:"post_details_username",children:e.jsx(h,{href:`/profile/${c}`,className:"username_link",children:c})}),e.jsxs("span",{className:"post_details_date",children:[e.jsx("span",{className:"post_date","data-title":l,children:_}),e.jsx("span",{className:"post_visibility","data-title":a,children:a=="public"?e.jsx(P,{"data-title":a}):e.jsx(T,{"data-title":a})})]})]})]})}),e.jsx("div",{className:"post_tags",children:d&&d.split(",").map((m,j)=>m.trim()!==""&&e.jsx("span",{className:"post_tag",children:e.jsx(h,{href:`/tag/${m.trim()}`,className:"post_tag_link",children:m.trim()})},j))}),e.jsx("div",{className:"post_content",children:u.split(`
`).map((m,j)=>e.jsx("div",{className:"post_content_inner",dangerouslySetInnerHTML:{__html:m}},j))}),e.jsx("div",{className:"divider_x"}),e.jsxs("div",{className:"post_reactions",children:[e.jsxs("button",{className:`like_reaction_btn content_center reaction_btn${b.liked?" liked":""} ${(v==null?void 0:v.like)&&"loading"}`,type:"button",onClick:w,children:[e.jsx($,{}),e.jsx("p",{className:"like_count count",children:y(+b.count)})]}),e.jsxs("button",{className:"comment_reaction_btn content_center reaction_btn",type:"button",onClick:()=>s({postid:r,username:c}),children:[e.jsx(L,{}),e.jsx("p",{className:"comment_count count",children:y(+n)})]})]})]})}function M({options:t,defaultOption:s=null,placeHolder:c="Select...",callValueWith:o,callLabelWith:r,onChange:_,...l}){const[d,u]=x.useState(!1),[p,n]=x.useState(s),i=a=>{n(a),_(a),u(!1)};return e.jsxs("div",{className:"dropdown",...l,children:[e.jsxs("button",{type:"button",className:"dropdownHead",onClick:()=>u(!d),children:[e.jsx("span",{children:(p==null?void 0:p.label)||c}),e.jsx("span",{style:{rotate:d?"180deg":"0deg"},children:e.jsx(F,{})})]}),e.jsx("div",{className:"dropdownBody "+(d?"open":""),children:t.map(a=>e.jsx("button",{type:"button",className:"dropdownBodyItem",onClick:()=>i(a),children:a[r]},a[o]))})]})}function H({setCreatePost:t,user:s}){const[c,o]=x.useState(!1),r=x.useRef(),{data:_,setData:l,postRequest:d}=f({dataTemplate:{tags:"",content:"",visibility:"public"},onSuccess:n=>{if((n==null?void 0:n.status)==200)return location.reload();o(!1),I(n==null?void 0:n.error)},onError:n=>{o(!1)}}),u=n=>{const i=n.split(",").map(a=>a.replace(/  +/g," ").replace(/[^a-zA-Z0-9, ]/g,"")).join(",");l("tags",i)};x.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style=null}),[]);const p=n=>{n.preventDefault();const a=r.current.innerText.split(`
`).filter(N=>!["",/  +/g].includes(N)).join(`
`);d(route("post.add"),{content:a}),o(!0)};return e.jsxs("div",{className:"create_new_post_page content_center",children:[e.jsxs("div",{className:"create_new_post_modelbox container",children:[e.jsxs("div",{className:"modelbox_header content_center",children:[e.jsx("div",{className:"modelbox_title",children:e.jsx("h2",{children:"Create post"})}),e.jsx("div",{className:"exit_modelbox",children:e.jsx("button",{className:"exit_modelbox_btn content_center",type:"button",onClick:()=>t(!1),children:e.jsx(S,{})})})]}),e.jsx("div",{className:"divider_x"}),e.jsxs("form",{className:"create_post_content",onSubmit:n=>p(n),children:[e.jsxs("div",{className:"create_post_content_header",children:[e.jsx("div",{className:"user_picture",children:e.jsx(h,{href:`/profile/${s==null?void 0:s.username}`,className:"post_user_picture_link",children:e.jsx("img",{src:s==null?void 0:s.picture,alt:"user_img"})})}),e.jsxs("div",{className:"user_post_details",children:[e.jsx("span",{className:"post_details_username",children:s==null?void 0:s.username}),e.jsx("span",{className:"post_details_visibility",children:e.jsx(M,{callLabelWith:"label",callValueWith:"value",onChange:n=>l("visibility",n==null?void 0:n.value),defaultOption:{value:"public",label:"Public"},options:[{value:"public",label:"Public"},{value:"private",label:"Private"}]})})]})]}),e.jsx("div",{className:"create_post_content_tags",children:e.jsx("input",{type:"text",className:"create_post_tags_input",placeholder:"Tags",value:_.tags,onChange:n=>u(n.target.value)})}),e.jsx("div",{className:"create_post_content_text",children:e.jsx("div",{className:"create_post_content_text_input",contentEditable:"true",ref:r,role:"textbox","data-placeholder":`What's on your mind, ${s==null?void 0:s.username} ?`})}),e.jsx("div",{className:"submit_post_section",children:e.jsx("button",{type:"submit",className:"submit_post_btn content_center",disabled:c,children:"Post"})})]})]}),c&&e.jsx(W,{text:"Posting"})]})}function O({user:t}){const[s,c]=x.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"create_new_post container",children:[e.jsx("div",{className:"user_img_link",children:e.jsx(h,{href:`/profile/${t==null?void 0:t.username}`,className:"link_img",children:e.jsx("img",{src:t==null?void 0:t.picture,alt:"user_picture"})})}),e.jsx("div",{className:"create_post",children:e.jsx("button",{className:"create_post_popup",type:"button",onClick:()=>c(!0),children:`What's on your mind, ${t==null?void 0:t.username} ?`})})]}),s&&e.jsx(H,{setCreatePost:c,user:t})]})}function U({comment:t}){const{content:s,age:c,formatted_created_at:o,username:r,picture:_}=t;return e.jsxs("div",{className:"comment_container",children:[e.jsx("div",{className:"comment_left_part",children:e.jsx("div",{className:"comment_user_picture",children:e.jsx(h,{to:`/profile/${r}`,className:"comment_user_picture_link content_center",children:e.jsx("img",{src:_,alt:"comment user picture"})})})}),e.jsxs("div",{className:"comment_right_part",children:[e.jsxs("div",{className:"comment_top",children:[e.jsx("div",{className:"comment_user_details",children:e.jsx(h,{to:`/profile/${r}`,className:"comment_username",children:r})}),e.jsx("div",{className:"comment_content",children:s&&s.split(`
`).map((l,d)=>e.jsx("div",{className:"post_content_inner",children:l},d))})]}),e.jsx("div",{className:"comment_bottom",children:e.jsx("p",{className:"comment_date light_text","data-title":o,children:c})})]})]})}function X({commentsState:t,updateCommentsCount:s}){const[{username:c,postid:o},r]=t,_=x.useRef();x.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=null}),[]);const{response:l,fetching:d,getRequest:u}=f({dataTemplate:{postid:o},autoFetch:()=>u(route("post.getcomments"))}),{postRequest:p}=f({dataTemplate:{postid:o,content:""},onSuccess:i=>{(i==null?void 0:i.status)==200&&(A("Comment sent"),s(o),_.current.innerText="",u(route("post.getcomments")))}}),n=i=>{i.preventDefault();const N=_.current.innerText.split(`
`).filter(b=>!["",/  +/g].includes(b)).join(`
`);p(route("post.addcomment"),{content:N})};return e.jsx("main",{className:"comments_page",children:e.jsxs("div",{className:"comments_container container",children:[e.jsxs("div",{className:"comments_header content_center",children:[e.jsx("div",{className:"comments_post_owner",children:e.jsxs("h2",{children:[e.jsx(h,{to:`/profile/${c}`,className:"comments_post_owner_link bold_text",children:c}),e.jsx("span",{children:"'s post"})]})}),e.jsx("button",{onClick:()=>r(null),className:"exit_comments_btn content_center",children:e.jsx(S,{})})]}),e.jsx("div",{className:"divider_x"}),e.jsxs("div",{className:"comments_content",children:[d&&e.jsx("div",{className:"loading_comments",children:e.jsx("p",{children:"Loading ..."})}),l!=null&&((l==null?void 0:l.data.length)>0?l==null?void 0:l.data.map((i,a)=>e.jsx(U,{comment:i},a)):e.jsx("div",{className:"no_comments",children:e.jsx("p",{children:"No comments rigth now"})}))]}),e.jsx("div",{className:"divider_x"}),e.jsxs("form",{className:"write_comment_section",onSubmit:i=>n(i),children:[e.jsx("div",{id:"comment_input",className:"write_comment_input",contentEditable:"true",role:"textbox",ref:_}),e.jsx("div",{className:"submit_comment_btn_container",onClick:()=>_.current.focus(),children:e.jsx("button",{type:"submit",className:"submit_comment_btn content_center",children:e.jsx(R,{})})})]})]})})}function z({user:t}){var o;const{response:s,getRequest:c}=f({autoFetch:()=>c(route("profile.authuser"))});return e.jsxs("div",{className:"authenticatedUser container content_center y",children:[e.jsx(h,{href:route("settings.profile"),"data-title":"edit you informations",className:"edit_profile_link",children:e.jsx(E,{})}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"image content_center",children:e.jsx(h,{href:"/profile/"+t.username,children:e.jsx("img",{src:t==null?void 0:t.picture,alt:"pfp"})})}),e.jsx("div",{className:"username content_center",children:e.jsx(h,{href:"/profile/"+t.username,className:"user_link",children:t==null?void 0:t.username})}),e.jsx("div",{className:"bio content_center",children:e.jsx("p",{children:((o=s==null?void 0:s.profile)==null?void 0:o.bio)||"no bio yet"})})]})]})}function te({user:t,initialPosts:s,showUserInfo:c=!0,children:o}){const[r,_]=x.useState(s),[l,d]=x.useState(null),u=r.length>0?r.map((n,i)=>e.jsx(B,{post:n,setCommentsTab:d},i)):e.jsx(D,{text:"Sorry .. posts not found"}),p=n=>{const i=[...r].map(a=>(n==a.postid&&(a.comments+=1),a));_(i)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"posts_page",children:[e.jsxs("div",{className:"posts_container",children:[o||e.jsxs("div",{className:"posts_header",children:[e.jsx(O,{user:t}),e.jsx(q,{name:"search"})]}),e.jsx("div",{className:"posts",children:u})]}),c&&e.jsx(z,{user:t})]}),l&&e.jsx(X,{commentsState:[l,d],updateCommentsCount:p})]})}export{O as C,te as P};
